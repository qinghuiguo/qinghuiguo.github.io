I"ßB<ul id="markdown-toc">
  <li><a href="#ä¸€-pmmç®€ä»‹" id="markdown-toc-ä¸€-pmmç®€ä»‹">ä¸€ã€ PMMç®€ä»‹ï¼š</a></li>
  <li><a href="#äºŒpmmæ¶æ„è§£æ" id="markdown-toc-äºŒpmmæ¶æ„è§£æ">äºŒã€PMMæ¶æ„è§£æ</a>    <ul>
      <li><a href="#clientå®¢æˆ·ç«¯" id="markdown-toc-clientå®¢æˆ·ç«¯">Clientå®¢æˆ·ç«¯</a></li>
      <li><a href="#pmm-server" id="markdown-toc-pmm-server">PMM Server</a></li>
    </ul>
  </li>
  <li><a href="#ä¸‰--pmméƒ¨ç½²" id="markdown-toc-ä¸‰--pmméƒ¨ç½²">ä¸‰ ã€ PMMéƒ¨ç½²ï¼š</a></li>
  <li><a href="#31-ç¯å¢ƒä»‹ç»" id="markdown-toc-31-ç¯å¢ƒä»‹ç»">3.1 ç¯å¢ƒä»‹ç»ï¼š</a>    <ul>
      <li><a href="#32-dockeréƒ¨ç½²pmm" id="markdown-toc-32-dockeréƒ¨ç½²pmm">3.2 dockeréƒ¨ç½²pmm</a></li>
      <li><a href="#33ä¸è¦å…³é—­é˜²ç«å¢™" id="markdown-toc-33ä¸è¦å…³é—­é˜²ç«å¢™">3.3ä¸è¦å…³é—­é˜²ç«å¢™</a></li>
    </ul>
  </li>
  <li><a href="#34å®‰è£…é…ç½®client" id="markdown-toc-34å®‰è£…é…ç½®client">3.4å®‰è£…é…ç½®client</a>    <ul>
      <li><a href="#34é…ç½®ç›‘æ§é¡¹" id="markdown-toc-34é…ç½®ç›‘æ§é¡¹">3.4é…ç½®ç›‘æ§é¡¹</a></li>
    </ul>
  </li>
  <li><a href="#å››-pmmç›‘æ§ä¼˜åŠ£" id="markdown-toc-å››-pmmç›‘æ§ä¼˜åŠ£">å›› ã€PMMç›‘æ§ä¼˜åŠ£</a></li>
  <li><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©pmm" id="markdown-toc-ä¸ºä»€ä¹ˆé€‰æ‹©pmm">ä¸ºä»€ä¹ˆé€‰æ‹©PMM</a></li>
  <li><a href="#pmmçš„ç¼ºç‚¹" id="markdown-toc-pmmçš„ç¼ºç‚¹">PMMçš„ç¼ºç‚¹</a></li>
</ul>

<blockquote>
  <p>PMMæ˜¯ä¸€æ¬¾å¼€æºçš„ç”¨äºç®¡ç†å’Œç›‘æ§MySQLã€PostgreSQLå’ŒMongoDBæ€§èƒ½çš„å¼€æºå¹³å°ï¼Œé€šè¿‡dockeréƒ¨ç½²ï¼Œä½†æ˜¯æœ¬æ–‡æ²¡æœ‰ä»‹ç»dockerã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥äº†è§£ä¸‹æœåŠ¡éƒ¨ç½²å®¹å™¨åŒ–çš„æ¦‚å¿µï¼Œæ®è¯´é˜¿é‡Œçš„RDSï¼ˆMySQLï¼‰ä½¿ç”¨DOCKERéƒ¨ç½²çš„ã€‚</p>
</blockquote>

<h1 id="ä¸€-pmmç®€ä»‹">ä¸€ã€ PMMç®€ä»‹ï¼š</h1>
<p>Percona Monitoring and Management (PMM)æ˜¯ä¸€æ¬¾å¼€æºçš„ç”¨äºç®¡ç†å’Œç›‘æ§MySQLã€PostgreSQLå’ŒMongoDBæ€§èƒ½çš„å¼€æºå¹³å°ï¼Œé€šè¿‡PMMå®¢æˆ·ç«¯æ”¶é›†åˆ°çš„DBç›‘æ§æ•°æ®ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶Grafanaç”»å›¾å±•ç¤ºå‡ºæ¥ã€‚</p>

<p>PMMæä¾›äº†å¯¹MyISAMã€InnoDBã€TokuDBã€PostgreSQLå’ŒPXC/Glareraçš„ç›‘æ§ï¼Œå¦å¤–ä¹Ÿæä¾›äº†Query Analyticsçš„åŠŸèƒ½ï¼Œå¯ä»¥æ£€è§†æ‰§è¡Œäº†å“ªäº›SQLæŒ‡ä»¤ï¼Œå¹¶å¯¹æ‰§è¡Œæ•ˆèƒ½è¾ƒå·®çš„è¯­æ³•è¿›è¡Œä¼˜åŒ–ã€‚å¦å¤–åœ¨æ–°ç‰ˆæœ¬è¿˜æ”¯æŒäº†MySQLå¤åˆ¶æ‹“æ‰‘å›¾ç»“æ„æ„é€ ã€‚</p>

<p>PMMé’ˆå¯¹æ“ä½œç³»ç»Ÿçš„éƒ¨ä»½ä¹Ÿæä¾›äº†ç¡¬ç›˜ã€ç½‘ç»œã€CPUå’ŒRAMçš„ç›‘æ§ï¼Œç‰¹åˆ«çš„æ˜¯å®ƒæä¾›äº†Context switchesã€Processeså’Œinterruptsçš„ç›‘æ§ï¼ŒContext Switcheså¯ä»¥çœ‹åˆ°CPUä¸Šä¸‹åˆ‡æ¢æ–‡çš„çŠ¶å†µï¼ŒProcesseså¯ä»¥æ–¹ä¾¿äº†è§£ç³»ç»Ÿæœ‰å¤šå°‘ç¨‹åºåœ¨ç­‰å¾…I/Oã€‚</p>

<h1 id="äºŒpmmæ¶æ„è§£æ">äºŒã€PMMæ¶æ„è§£æ</h1>
<p>PMMå¹³å°åŸºäºcsæ¶æ„ï¼Œå¯æ”¯æŒæ‰©å±•ã€‚å®ƒåŒ…æ‹¬ä»¥ä¸‹æ¨¡å—ï¼š</p>

<ul>
  <li>
    <p>PMMå®¢æˆ·ç«¯å®‰è£…åœ¨è¦ç›‘è§†çš„æ¯ä¸ªæ•°æ®åº“ä¸»æœºä¸Šã€‚ å®ƒæ”¶é›†æœåŠ¡å™¨æŒ‡æ ‡ï¼Œå¸¸è§„ç³»ç»ŸæŒ‡æ ‡å’ŒæŸ¥è¯¢åˆ†ææ•°æ®ï¼Œä»¥è·å¾—å®Œæ•´çš„æ€§èƒ½æ¦‚è¿°ã€‚</p>
  </li>
  <li>
    <p>PMM Serveræ˜¯PMMçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒèšåˆæ”¶é›†çš„æ•°æ®å¹¶ä»¥Webç•Œé¢ä¸­çš„è¡¨æ ¼ï¼Œä»ªè¡¨æ¿å’Œå›¾å½¢çš„å½¢å¼å‘ˆç°ã€‚</p>
  </li>
</ul>

<p>è¿™äº›æ¨¡å—çš„å°è£…ä¾¿äºå®‰è£…å’Œä½¿ç”¨ã€‚ å‡è®¾ç”¨æˆ·ä¸éœ€è¦äº†è§£æ„æˆæ¯ä¸ªæ¨¡å—çš„ç¡®åˆ‡å·¥å…·ä»¥åŠå®ƒä»¬å¦‚ä½•äº¤äº’ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³å……åˆ†å‘æŒ¥PMMçš„æ½œåŠ›ï¼Œäº†è§£å†…éƒ¨ç»“æ„éå¸¸é‡è¦ã€‚</p>

<p>PMMæ˜¯ä¸€ç³»åˆ—æ—¨åœ¨æ— ç¼ååŒå·¥ä½œçš„å·¥å…·ã€‚ æœ‰äº›æ˜¯ç”±Perconaå¼€å‘çš„ï¼Œæœ‰äº›æ˜¯ç¬¬ä¸‰æ–¹å¼€æºå·¥å…·ã€‚</p>

<blockquote>
  <p>æ³¨æ„ 
æ•´ä½“C-Sæ¶æ„ä¸å¤ªå¯èƒ½æ”¹å˜ï¼Œä½†ç»„æˆæ¯ä¸ªç»„ä»¶çš„å·¥å…·é›†å¯èƒ½éšäº§å“è€Œå˜åŒ–ã€‚</p>
</blockquote>

<p>ä¸‹å›¾è¯´æ˜äº†PMMå½“å‰çš„ç»“æ„</p>

<h2 id="clientå®¢æˆ·ç«¯">Clientå®¢æˆ·ç«¯</h2>
<p>æ¯ä¸ªPMMå®¢æˆ·ç«¯æ”¶é›†æœ‰å…³ä¸€èˆ¬ç³»ç»Ÿå’Œæ•°æ®åº“æ€§èƒ½çš„å„ç§æ•°æ®ï¼Œå¹¶å°†æ­¤æ•°æ®å‘é€åˆ°ç›¸åº”çš„PMMæœåŠ¡å™¨ã€‚</p>

<p>PMMå®¢æˆ·ç«¯è½¯ä»¶åŒ…åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>

<ul>
  <li>
    <p>pmm-adminæ˜¯ç”¨äºç®¡ç†PMMå®¢æˆ·ç«¯çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¾‹å¦‚ï¼Œæ·»åŠ å’Œåˆ é™¤è¦ç›‘è§†çš„æ•°æ®åº“å®ä¾‹ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ç®¡ç†PMMå®¢æˆ·ç«¯ ã€‚</p>
  </li>
  <li>
    <p>pmm-mysql-queries-0æ˜¯ä¸€ä¸ªç®¡ç†QANä»£ç†çš„æœåŠ¡ï¼Œå®ƒä»MySQLæ”¶é›†æŸ¥è¯¢æ€§èƒ½æ•°æ®å¹¶å°†å…¶å‘é€åˆ°PMM Serverä¸Šçš„QAN APIã€‚</p>
  </li>
  <li>
    <p>pmm-mongodb-queries-0æ˜¯ä¸€ä¸ªç®¡ç†QANä»£ç†çš„æœåŠ¡ï¼Œå®ƒä»MongoDBæ”¶é›†æŸ¥è¯¢æ€§èƒ½æ•°æ®å¹¶å°†å…¶å‘é€åˆ°PMM Serverä¸Šçš„QAN APIã€‚</p>
  </li>
  <li>
    <p>node_exporter æ˜¯ä¸€ä¸ªç”¨äºæ”¶é›†å¸¸è§„ç³»ç»ŸæŒ‡æ ‡çš„Prometheus exporterã€‚</p>
  </li>
  <li>
    <p>mysqld_exporteræ˜¯ä¸€ä¸ªæ”¶é›†MySQLæŒ‡æ ‡çš„Prometheus exporterã€‚</p>
  </li>
  <li>
    <p>mongodb_exporteræ˜¯ä¸€ä¸ªæ”¶é›†MongoDBæŒ‡æ ‡çš„çš„Prometheus exporterã€‚</p>
  </li>
  <li>
    <p>proxysql_exporteræ˜¯ä¸€ä¸ªç”¨äºæ”¶é›†ProxySQLæ€§èƒ½æŒ‡æ ‡çš„Prometheus exporterã€‚</p>
  </li>
  <li>
    <p>postgres_exporteræ˜¯ä¸€ä¸ªç”¨äºæ”¶é›†PostgreSQLæ€§èƒ½æŒ‡æ ‡çš„exporterã€‚</p>
  </li>
</ul>

<h2 id="pmm-server">PMM Server</h2>
<p>PMM Serveråœ¨å°†ä½œä¸ºä¸­å¤®ç›‘æ§ä¸»æœºçš„è®¡ç®—æœºä¸Šè¿è¡Œã€‚ å®ƒé€šè¿‡ä»¥ä¸‹æ–¹å¼ä½œä¸ºåº”ç”¨åˆ†å‘ï¼š</p>

<ul>
  <li>
    <p>å¯ç”¨äºè¿è¡Œå®¹å™¨çš„Dockeré•œåƒ</p>
  </li>
  <li>
    <p>æ‚¨å¯ä»¥åœ¨VirtualBoxæˆ–å…¶ä»–è™šæ‹Ÿæœºç›‘æ§ç¨‹åºä¸­è¿è¡Œçš„OVAã€‚</p>
  </li>
  <li>
    <p>æ‚¨å¯ä»¥é€šè¿‡Amazon Web Servicesè¿è¡Œçš„AMI ã€‚</p>
  </li>
</ul>

<p>æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…å®‰è£…PMM Server ã€‚</p>

<p>PMM ServeråŒ…æ‹¬ä»¥ä¸‹å·¥å…·ï¼š</p>

<ul>
  <li>
    <p>Query Analytics(QAN)å¯ä»¥åˆ†æä¸€æ®µæ—¶é—´å†…çš„MySQLæŸ¥è¯¢æ€§èƒ½ã€‚ é™¤å®¢æˆ·ç«¯QANä»£ç†å¤–ï¼Œè¿˜åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p>

    <ul>
      <li>QAN APIæ˜¯ç”¨äºå­˜å‚¨å’Œè®¿é—®åœ¨PMMå®¢æˆ·ç«¯ä¸Šè¿è¡Œçš„QANä»£ç†æ”¶é›†çš„æŸ¥è¯¢æ•°æ®çš„åç«¯ã€‚</li>
      <li>QAN Web Appæ˜¯ä¸€ä¸ªç”¨äºå¯è§†åŒ–æ”¶é›†çš„Query Analyticsæ•°æ®çš„Webåº”ç”¨ç¨‹åºã€‚</li>
    </ul>
  </li>
  <li>
    <p>Metrics Monitor(MM)æä¾›ç»„ä»¶æä¾›äº†MySQLã€PostgreSQLå’ŒMongoDBå†å²ç›‘æ§ä¿¡æ¯ã€‚ å®ƒåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p>

    <ul>
      <li>Perconaä»ªè¡¨æ¿æ˜¯Perconaå¼€å‘çš„Grafanaä»ªè¡¨æ¿ã€‚</li>
      <li>Orchestratoræ˜¯ä¸€ä¸ªMySQLå¤åˆ¶æ‹“æ‰‘ç®¡ç†å’Œå¯è§†åŒ–å·¥å…·ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ï¼š Orchestratoræ‰‹å†Œã€‚</li>
      <li>Consulæä¾›äº†ä¸€ä¸ªAPIï¼Œ PMMå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨è¯¥APIä¸ºPrometheusè¿œç¨‹åˆ—å‡ºã€æ·»åŠ å’Œåˆ é™¤çš„ä¸»æœºã€‚ å®ƒè¿˜å­˜å‚¨ç›‘æ§å…ƒæ•°æ®ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Consul Docs ã€‚</li>
      <li>Prometheusæ˜¯ç¬¬ä¸‰æ–¹æ—¶é—´åºåˆ—æ•°æ®åº“ï¼Œå®ƒè¿æ¥åˆ°åœ¨PMMå®¢æˆ·ç«¯ä¸Šè¿è¡Œçš„exporterå¹¶èšåˆç”±exporteræ”¶é›†çš„æ•°æ®ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Prometheusæ–‡æ¡£ ã€‚</li>
      <li>Grafanaæ˜¯ç¬¬ä¸‰æ–¹ä»ªè¡¨æ¿å’Œå›¾å½¢æ„å»ºå™¨ï¼Œç”¨äºå¯è§†åŒ–Prometheusä¸­èšåˆçš„æ•°æ®ï¼Œä»¥Webå‘ˆç°ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…Grafanaæ–‡æ¡£ ã€‚</li>
    </ul>
  </li>
</ul>

<h1 id="ä¸‰--pmméƒ¨ç½²">ä¸‰ ã€ PMMéƒ¨ç½²ï¼š</h1>
<h1 id="31-ç¯å¢ƒä»‹ç»">3.1 ç¯å¢ƒä»‹ç»ï¼š</h1>

<p>|ä¸»æœºå |	IP	|å®ä¾‹|æ“ä½œç³»ç»Ÿ|
|:â€”- | :â€”- :â€”- | :â€”-|
|pmm-server|	192.168.56.10|	PMMå®ä¾‹|	CentOS 7.4.1708|
|server0	|192.168.56.20|	PostgreSQL|	Red Hat 6.5|
|centos1	|192.168.56.21|	MySQL|	CentOS 6.8|
|server2	|192.168.56.22|	MySQL|	Red Hat 6.5|
|server3	|192.168.56.23|	MySQL|	Red Hat 6.5|</p>
<h2 id="32-dockeréƒ¨ç½²pmm">3.2 dockeréƒ¨ç½²pmm</h2>
<p>å®‰è£…ä¾èµ–åŒ…</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install yum-utils device-mapper-persistent-data lvm2
</code></pre></div></div>
<p>é…ç½®ç¨³å®šä»“åº“</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo

# yum-config-manager --add-repo https://mirrors.aliyun/docker-ce/linux/

# yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre></div></div>
<p>å®‰è£…æŒ‡å®šç‰ˆæœ¬docker</p>

<p>éœ€è¦æ³¨æ„docker-ce å’Œdocker-ce-selinuxä¾èµ–å…³ç³»</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@pmm-server1 ~]#  yum list docker-ce --showduplicates | sort -r

[root@pmm-server1 ~]# yum list docker-ce-selinux --showduplicates | sort -r

[root@pmm-server1 ~]# yum install  --setopt=obsoletes=0 \

docker-ce-17.03.2.ce-1.el7.centos.x86_64 \

docker-ce-selinux-17.03.2.ce-1.el7.centos.noarch
</code></pre></div></div>
<p>å¯åŠ¨docker</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@pmm-server1 ~]# systemctl start docker

[root@pmm-server1 ~]# systemctl status docker
</code></pre></div></div>
<p>Pulling the PMM Server Image</p>

<p>é•œåƒæ‹‰å–é€Ÿåº¦è¾ƒæ…¢ï¼Œå¤±è´¥å¤šæ¬¡ï¼Œç½‘é€Ÿè¦æ±‚é«˜ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nohup docker pull percona/pmm-server:latest &amp;
</code></pre></div></div>
<p>åˆ›å»ºpmm-dataå®¹å™¨</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker create -v /opt/prometheus/data -v /opt/consul-data -v /var/lib/mysql -v /var/lib/grafana --name pmm-data percona/pmm-server:latest /bin/true
</code></pre></div></div>
<p>åˆ›å»ºå’Œå¯åŠ¨pmm-serverå®¹å™¨</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -d -e ORCHESTRATOR_ENABLED=true -e METRICS_RETENTION=720h -e SERVER_USER=admin -e SERVER_PASSWORD=mysql -p 80:80 -p 443:443 --name pmm-server --volumes-from pmm-data percona/pmm-server:latest
</code></pre></div></div>
<p>æ£€æŸ¥dockerçŠ¶æ€</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat -tunlp | grep docker

docker ps
</code></pre></div></div>
<h2 id="33ä¸è¦å…³é—­é˜²ç«å¢™">3.3ä¸è¦å…³é—­é˜²ç«å¢™</h2>

<p>pmm-serveréœ€è¦å¼€å¯å¦‚ä¸‹ç«¯å£ã€‚</p>

<blockquote>
  <p>CentOS7ä½¿ç”¨firewalldæœåŠ¡ï¼Œä¸éœ€è¦é…ç½®ipttablesï¼ˆè¯¥æœåŠ¡é»˜è®¤æœªå®‰è£…ï¼‰</p>
</blockquote>

<p>ä¸»æœºä¿¡æ¯ç›‘æ§ç«¯å£ï¼šlinux:metrics</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firewall-cmd --permanent --zone=public --add-port=42000/tcp 

æ…¢æŸ¥è¯¢æ€§èƒ½æ•°æ®ç«¯å£ï¼š

firewall-cmd --permanent --zone=public --add-port=42001/tcp

MySQLå®ä¾‹ç›‘æ§ç«¯å£ï¼šmysql:metrics

firewall-cmd --permanent --zone=public --add-port=42002/tcp

MongoDBå®ä¾‹ç›‘æ§ç«¯å£ï¼šmongodb:metrics

firewall-cmd --permanent --zone=public --add-port=42003/tcp 

ProxySQLç›‘æ§ç«¯å£ï¼šproxysql:metrics

firewall-cmd --permanent --zone=public --add-port=42004/tcp

PostgreSQLå®ä¾‹ç›‘æ§ç«¯å£postgresql:metrics

firewall-cmd --permanent --zone=public --add-port=42005/tcp 

firewall-cmd --list-all 

firewall-cmd --reload
</code></pre></div></div>
<h1 id="34å®‰è£…é…ç½®client">3.4å®‰è£…é…ç½®client</h1>
<p>ä¸‹è½½clientç«¯,ä¸‹è½½åœ°å€</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># tar xvf  pmm-client-1.17.0.tar.gz

****

# cd  pmm-client-1.17.0.tar.gz



# ./install
</code></pre></div></div>
<h2 id="34é…ç½®ç›‘æ§é¡¹">3.4é…ç½®ç›‘æ§é¡¹</h2>
<p>æŠŠclientæ³¨å†Œåˆ°serverç«¯ï¼Œæ¯ä¸ªclientç«¯éƒ½éœ€è¦æ³¨å†Œ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pmm-admin config --server 192.168.56.10 --server-user admin --server-password oracle

cat /usr/local/percona/pmm-client/pmm.yml
</code></pre></div></div>
<p>æ”¶é›†mysqlæ€§èƒ½æ•°æ®</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@centos1 log]# pmm-admin add mysql --user root --password 123456 --host localhost



[root@centos1 log]# pmm-admin list 

pmm-admin 1.17.0



PMM Server      | 192.168.56.10 (password-protected)

Client Name     | centos1

Client Address  | 192.168.56.21 

Service Manager | linux-upstart



-------------- -------- ----------- -------- ----------------------------------------- --------------------------------------------------------------------------------------

SERVICE TYPE   NAME     LOCAL PORT  RUNNING  DATA SOURCE                               OPTIONS                                                                              

-------------- -------- ----------- -------- ----------------------------------------- --------------------------------------------------------------------------------------

mysql:queries  centos1  -           YES      root:***@unix(/var/lib/mysql/mysql.sock)  query_source=slowlog, query_examples=true, slow_log_rotation=true, retain_slow_logs=1 

linux:metrics  centos1  42000       YES      -                                                                                                                              

mysql:metrics  centos1  42002       YES      root:***@unix(/var/lib/mysql/mysql.sock)  
</code></pre></div></div>
<p>MySQLç›‘æ§é¦–é¡µ</p>

<p>æ”¶é›†PostgreSQLæ€§èƒ½æ•°æ® 
æ·»åŠ çš„ç›‘æ§é¡¹</p>

<p>linux:metrics :ç³»ç»Ÿæ•°æ® 
postgresql:metricsï¼š 
å¼€å¯PGçš„IOç»Ÿè®¡ 
ALTER SYSTEM SET track_io_timing=ON; 
SELECT pg_reload_conf();</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pmm-admin add postgresql --host=localhost --password='123456' --port=5432 --user=postgres



[root@server0 ~]# pmm-admin list 

pmm-admin 1.17.0



PMM Server      | 192.168.56.10 (password-protected)

Client Name     | server0

Client Address  | 192.168.56.20 

Service Manager | linux-upstart



------------------- -------- ----------- -------- --------------------------------------- --------

SERVICE TYPE        NAME     LOCAL PORT  RUNNING  DATA SOURCE                             OPTIONS 

------------------- -------- ----------- -------- --------------------------------------- --------

linux:metrics       server0  42000       YES      -                                              

postgresql:metrics  server0  42005       YES      postgresql:***@localhost:5432/postgres  

</code></pre></div></div>
<p>PostgreSQLç›‘æ§é¦–é¡µ</p>

<h1 id="å››-pmmç›‘æ§ä¼˜åŠ£">å›› ã€PMMç›‘æ§ä¼˜åŠ£</h1>
<p>*æœ¬ç« å‚è€ƒæ–‡æ¡£ï¼šæœ¬èŠ‚åŸæ–‡åœ°å€</p>

<h1 id="ä¸ºä»€ä¹ˆé€‰æ‹©pmm">ä¸ºä»€ä¹ˆé€‰æ‹©PMM</h1>
<ul>
  <li>
    <p>ç›‘æ§ä¿¡æ¯æœ€å…¨ï¼Œå¼€æºçš„ç›‘æ§æ–¹æ¡ˆæˆ‘ç”¨è¿‡zabbix,open-falcon,è‡ªå·±é‡‡é›†+ES+Kibana/grafanaã€‚é‡‡é›†çš„æŒ‡æ ‡é¡¹å¾ˆå¤šæ˜¯æ•°æ®æœ‰è¯¯ï¼Œä¸åŠæ—¶ï¼Œæˆ–è€…æ ¹æœ¬æ— æ•°æ®ã€‚è¿™æ ·çš„æŠ½é£çš„ç›‘æ§ç³»ç»Ÿä¼šç»™è‡ªå·±çš„åˆ†æå¸¦æ¥ä¸è‡ªä¿¡ï¼Œæœ‰å­˜åœ¨çš„å¿…è¦å—ï¼Ÿ</p>
  </li>
  <li>
    <p>ç•Œé¢æœ€ç›´è§‚ï¼Œç»†èŠ‚è¾ƒå¤šã€‚ä½ èƒ½æƒ³åˆ°çš„ï¼Œæƒ³ä¸åˆ°çš„éƒ½ç»™ä½ æä¾›äº†ã€‚è¿™å¯¹æˆ‘è¿™æ ·èœé€¼DBAæ¥è¯´æ˜¯å¾ˆé‡è¦çš„ã€‚å¯ä»¥æ ¹æ®ç›‘æ§å›¾å½¢è¶‹åŠ¿çŒœå‡ºå®ä¾‹crashæˆ–è€…é«˜è´Ÿè½½å‰åçš„ä¿¡æ¯ã€‚ä¿¡æ¯å°‘çš„ç›‘æ§ç³»ç»Ÿåˆ†æä¸å‡ºä»€ä¹ˆèŠ±æ ·æ¥ï¼ŒçæŠ æµªè´¹æ—¶é—´ã€‚</p>
  </li>
  <li>
    <p>æ”¯æŒçš„æ•°æ®åº“ç±»å‹æœ€å¤šï¼ŒPG/MySQL(å«PXC,MGR,TOKU,ROCKS)/MongoDB(å«MONGOS)/OSã€‚åˆ†æä¸€ä¸ªä¸šåŠ¡çš„OS/MONGODB/MYSQLæ€§èƒ½è¦è·¨è¶Šä¸¤ä¸‰ä¸ªwebç½‘ç«™ï¼Œçƒ¦ä¸çƒ¦ï¼Ÿ</p>
  </li>
  <li>
    <p>æ”¯æŒæ…¢æŸ¥è¯¢åˆ†æ,æ¯”annometeræˆ–è€…logstashçš„é…ç½®æ¯”èµ·æ¥ç®€å•ä¸€ä¸‡å€ã€‚åªè¦é…ç½®ç›‘æ§å°±å¯ä»¥ï¼Œagentå¯ä»¥æ ¹æ®å¯è°ƒèŠ‚çš„å¼€å…³ä»ISæˆ–è€…æ…¢æ—¥å¿—ä¸­æ•æ‰æ…¢æŸ¥è¯¢ï¼Œé«˜é¢‘SQL</p>
  </li>
  <li>
    <p>åŸºäºgrafanaï¼Œå¯ä»¥å¼•å…¥oauthæˆ–è€…Ldapæ–¹ä¾¿å¯¹ç°æœ‰çš„ç»„ç»‡ç»“æ„è¿›è¡Œå¼•å…¥ï¼Œæ ¹æ®ä¸šåŠ¡å¯¹äºå›¾å½¢è¿›è¡Œåˆ†åˆ«æˆæƒã€‚é˜²æ­¢ä¸šåŠ¡çš„æ´»è·ƒä¿¡æ¯ï¼ŒIPç­‰æœ‰ä»·å€¼ä¿¡æ¯è¢«æ³„éœ²</p>
  </li>
  <li>
    <p>é›†æˆäº†Orchestratorç”¨äºå¤åˆ¶æ‹“è¡¥ç®¡ç†å’Œå¯è§†åŒ–</p>
  </li>
</ul>

<h1 id="pmmçš„ç¼ºç‚¹">PMMçš„ç¼ºç‚¹</h1>

<ul>
  <li>
    <p>PMM é»˜è®¤ä½¿ç”¨ä¸»æœºåä½œä¸ºå”¯ä¸€è¯†åˆ«æ•°æ®åº“å®ä¾‹çš„å…³é”®å­—ã€‚
åœ¨dockerç¯å¢ƒä¸‹,å•æœºå•å®ä¾‹,å®ä¾‹åå’Œä¸»æœºåä¿æŒä¸€è‡´ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯ä¸å¯¹å¤–å±•ç¤ºIPå’Œç«¯å£è¿˜æ˜¯è¹©è„šã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘çš„è§†é‡æ¯”è¾ƒçª„ï¼Œæˆ–è®¸æ ¹æœ¬ä¸éœ€è¦ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬è¿™è¾¹æ²¡æœ‰æ•°æ®åº“å¾®æœåŠ¡çš„æƒ…å†µä¸‹ï¼ŒIPå’Œç«¯å£è¿˜æ˜¯æ¯”è¾ƒå…³é”®çš„ä¿¡æ¯ç‚¹ï¼Œè€Œä¸”å•ç‰©ç†æœºå¤šæ•°æ®åº“å®ä¾‹ä¸‹çš„ä½¿ç”¨æ•ˆæœå¹¶ä¸å¥½ã€‚ä¸»è¦ä½“ç°åœ¨æ— æ³•ä½¿ç”¨IPå¯¹å®ä¾‹è¿›è¡Œæ±‡æ€»</p>
  </li>
  <li>
    <p>éœ€è¦sudoæƒé™</p>
  </li>
</ul>

<p>åœ¨æŸäº›æƒé™ç®¡ç†æ¯”è¾ƒä¸¥æ ¼çš„æƒ…å†µä¸‹ï¼Œdbaæ²¡æœ‰sudoæƒé™ï¼Œæ— æ³•è¿è¡Œpmm-client</p>

<ul>
  <li>
    <p>æœåŠ¡ç«¯ä¸å¥½æ‹†åˆ†
å®˜æ–¹é‡‡ç”¨å•èŠ‚ç‚¹Prometheusæ¥å­˜å‚¨ç›‘æ§Metricï¼Œå°ç¯å¢ƒè¿˜å¯ä»¥ï¼Œæ•°åƒæ•°ä¸‡å°çš„æƒ…å†µä¸‹ovaæˆ–è€…dockeråŒ–çš„æœåŠ¡ç«¯å®¹æ˜“çˆ†ç›˜ã€‚è¿™ä¸ªæ—¶å€™æ˜“äºéƒ¨ç½²çš„ovaæˆ–è€…dockeråˆ†å‘æ–¹å¼åè€Œå˜æˆäº†ç¼ºç‚¹ã€‚</p>
  </li>
  <li>
    <p>ovaåˆ†å‘æ–¹å¼ä¿®æ”¹ovaå¯†ç éº»çƒ¦</p>
  </li>
  <li>
    <p>ä¿®æ”¹Ovaçš„è™šæ‹Ÿæœºçš„Linuxå¯†ç åï¼Œè®¿é—®ç›‘æ§é¡µé¢ä¹Ÿéœ€è¦è¾“å…¥å¯†ç ï¼Œagentç«¯æ³¨å†Œä¹Ÿéœ€è¦å¯†ç ã€‚å½“ç„¶å¦‚æœä½ ä¸å»ä¿®æ”¹Ovaçš„å¯†ç ä¹Ÿæ²¡é—®é¢˜</p>
  </li>
  <li>
    <p>æœåŠ¡ç«¯loadé«˜</p>
  </li>
</ul>

<blockquote>
  <p>å‚è€ƒæ–‡æ¡£
https://www.percona.com/doc/percona-monitoring-and-management/index.html 
http://www.mamicode.com/info-detail-2518131.html 
DEMOå®˜ç½‘åœ°å€ï¼šhttp://pmmdemo.percona.com 
æ•°æ®é‡‡é›†å·¥å…·åœ°å€ï¼š 
node_exporterï¼šhttps://github.com/percona/node_exporter 
[mysqld_exporterï¼šhttps://github.com/percona/mysqld_exporter 
mongodb_exporterï¼šhttps://github.com/percona/mongodb_exporter 
proxysql_exporterï¼šhttps://github.com/percona/proxysql_exporter 
postgres_exporterï¼šhttps://github.com/percona/postgres_exporter</p>
</blockquote>

:ET